local SERVER_URL = "http://localhost:8080/next"
local POLL_DELAY = 3

local function httpGet(url)
    if syn and syn.request then
        return syn.request({ Url = url, Method = "GET" }).Body
    elseif request then
        return request({ Url = url, Method = "GET" }).Body
    elseif http_request then
        return http_request({ Url = url, Method = "GET" }).Body
    end
end

local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

print("[CLIENT]")

while true do
    local body = nil

    pcall(function()
        body = httpGet(SERVER_URL)
    end)

    if body then
        print("[RAW]", body)

        local ok, data = pcall(function()
            return HttpService:JSONDecode(body)
        end)

        if ok and data then
            if data.jobId then
                print("[JOIN]", data.jobId)

                TeleportService:TeleportToPlaceInstance(
                    data.placeId,
                    data.jobId,
                    player
                )
            end
        end
    end

    task.wait(POLL_DELAY)
end
